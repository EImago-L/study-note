# 计算机组成原理

# **系统概论**

## **冯诺依曼结构计算机工作原理**

### **工作原理**

存储程序：将程序存储在计算机的存储器中；

程序控制：按指令地址访问存储器并取出指令，经译码依次产生指令执行所需的控制信号，实现对计算机的控制，完成指令的功能。



### 冯诺依曼计算机的组成（硬件+软件）

![image-20220813181234342](https://eimago.oss-cn-beijing.aliyuncs.com/typora-img/image-20220813181234342.png)



#### **硬件系统**

##### 运算器

负责算术运算（加减乘除等）、逻辑运算（与或非 位移等）。

基本结构：ALU（Arithmetic Logical unit）、寄存器、连接通路

![image-20220813181728433](https://eimago.oss-cn-beijing.aliyuncs.com/typora-img/image-20220813181728433.png)



##### **控制器**

基本功能：产生指令执行过程所需要的所有控制信号，控制相关功能部件执行相应操作

控制信号的形式：电平信号、脉冲信号

产生控制信号的依据：指令、状态、时序

控制信号的产生方式：微程序、硬布线

![image-20220813182042842](https://eimago.oss-cn-beijing.aliyuncs.com/typora-img/image-20220813182042842.png)



##### **存储器**

功能：存储原程序、原数据、运算中间结果

工作模式：读/写；

工作原理：按地址访问，读/写数据。

![image-20220813182404850](https://eimago.oss-cn-beijing.aliyuncs.com/typora-img/image-20220813182404850.png)

容量--->地址线数量

1K ----> 10

1M ----> 20

1G ----> 30

> q：要访问256G的主存空间，至少需要多少地址线？
>
> a：
>
> 1024Byte(字节)=1kB
>
> 1024kB=1MB
>
> 1024MB=1GB
>
> 1024=2^10^
>
> 1GB=2^30^B
>
> 内存容量2^n^字节-->地址总线n根
>
> 256GB=2^38^字节-->地址总线38根



##### **输入输出设备**

输入设备：向计算机输入数据（键盘、鼠标、网卡、扫描仪等）

输出设备：输出处理结果（显示器、声卡、网卡、打印机等）



#### **软件系统**

对于软件的理解：

- 可运行的思想和内容的数字化

  思想：算法、规律、方法----程序表达

  内容：图形、图像、数据、声音文字等被处理的对象

- 软件的表现形式：程序和数据（以二进制表示的信息）

- 软件的核心：算法



![image-20220813183243850](https://eimago.oss-cn-beijing.aliyuncs.com/typora-img/image-20220813183243850.png)

- 系统软件

  操作系统、网络系统、编译系统等

- 支持软件

  开发工具、界面工具等

- 应用软件

  游戏软件、办公软件等



### **计算机的层次结构**

<img src="https://eimago.oss-cn-beijing.aliyuncs.com/typora-img/image-20220813183518988.png" alt="image-20220813183518988" style="zoom:50%;" />

指令集架构层为硬件和软件的分界线



## **计算机系统性能评价**

### **非时间指标**

1. 机器字长：指机器一次能处理的二进制位数

   - 由加法器、寄存器的位数决定；
   - 一般与内部寄存器和位数相等（字长）
   - 字长越长，表示数据的范围就越大，精确度越高；
   - 目前常见的有32位和64位

2. 总线宽度：数据总线一次能并行转送的最大信息的位数

   - 一般指运算器与存储器之间的数据总线位数。
   - 有些计算机内部与外部数据总线宽度不一致
   - 8086、80286、 80386内外数据总线等宽
   - 8088、80386SX 外部总线宽度8位内部总线宽度16位
   - Pentium外总线64位,内总线32位（两条32位流水线）

   ![image-20220813192003616](https://eimago.oss-cn-beijing.aliyuncs.com/typora-img/image-20220813192003616.png)

3. 主存容量与存储带宽

   - 主存容量：是指一台计算机主存所包含的存储单元总数。
   - 存储带宽：指单位时间内与主存交换的二进制信息量，常用单位B/S(字节/秒)。（影响存储带宽的指标包括数据位宽和数据传输速率）。



### **时间指标**

#### **主频f/时钟周期T，外频、倍频**

- 主频f：指CPU内核工作的时钟频率，即CPU内数字脉冲信号振荡的速率，与CPU实际的运算能力之间不是唯一的、直接关系

- 时钟周期T：也称节拍周期，是计算机中最基本、最小的时间单位。在一个时钟周期内，CPU仅完成一个最基本的动作；

  > f与T的关系：
  >
  > 互为倒数，f越高，T就越小（f=100MHz时T=10ns， f=1GHz时T=1ns）

- 外频：指CPU（内存）与主板之间同步的时钟频率（系统总线的工作频率）；

- 倍频：CPU主频与外频之间的倍数；

  > 主频=外频×倍频



#### **CPI**

Clock cycles Per Instruction

执行一条指令（平均）需要的时钟周期数（即T周期的个数）

可有多个维度如单条指令CPI、一段程序中所有指令的CPI、指令系统CPI等

IPC（Instruction Per Clock） 每个时钟周期内执行的指令条数（并行）



$$CPI = \frac{ 程序中所有指令的时钟周期数之和}{程序指令总数} = \sum (程序中各类指令的CPI × 程序中该类指令的比列)$$

 

应用举例：

> 某计算机指令系统中各类指令所占比例及CPI如下表所示，求程序的CPI

|   指令类型    | CPI  | 指令比例 |
| :-----------: | :--: | :------: |
|  算术和逻辑   |  1   |   60%    |
|  Load/Store   |  2   |   18%    |
|     转移      |  4   |   12%    |
| Cache缺失访问 |  8   |   10%    |

解：CPI = 1\*60% + 2\*18% + 4 \*12% + 8\*10% = 2.24



#### **MIPS**

Million Instrucitons Per Second

每秒钟CPU能执行的指令总条数（单位：百万秒/条）

$$MIPS = \frac{ 指令条数}{执行时间 × 10^6} 
= \frac{指令条数}{(所有指令CPU时钟周期数之和/f)×10^6}
= \frac{f}{CPI ×10^6}$$

应用举例：

> 某计算机主频为1GHZ，在其上运行的目标代码包含2×10^5^条指令，分4类，各类指令所占比例和各自CPI如下表所示，求程序的MIPS。

|   指令类型    | CPI  | 指令比例 |
| :-----------: | :--: | :------: |
|  算术和逻辑   |  1   |   60%    |
|  Load/Store   |  2   |   18%    |
|     转移      |  4   |   12%    |
| Cache缺失访问 |  8   |   10%    |

解：根据CPU全性能公式：$MIPS = \frac{f}{CPI ×10^6}$

CPI = 1\*60% + 2\*18% + 4 \*12% + 8\*10% = 2.24

MIPS = f/(CPI * 10^6^) = 1\*10^9^/(2.24*10^6^) = 446.4



#### **CPU时间**

执行一段程序所需的时间 = （CPU时间 + I/O时间 + 存储访问时间 + 各类排队时延等）。

CPU时间 = 程序中所有指令的时钟周期数之和 × T = 程序中所有指令的时钟周期数之和 / f

CPU时间的计算方法：

- 考虑CPI后的CPU时间

  $$CPU时间=总指令数×\sum_{i=1}^n(CPI_I×\frac{IC_i}{总指令数})×时钟周期时间=总指令数×CPI×T$$

- 考虑MIPS后的CPU时间

  $$MIPS = \frac{指令数量}{指令执行时间 × 10^6}$$

  $$程序的执行时间 t=\frac{指令数量}{MIPS×10^6}$$



应用举例：

> 某计算机主屏为1GHZ，在其上运行的目标代码包含2×10^5^条指令，分4类，各类指令所占比例和各自CPI如下表所示，求该段程序的CPU时间。

|   指令类型    | CPI  | 指令比例 |
| :-----------: | :--: | :------: |
|  算术和逻辑   |  1   |   60%    |
|  Load/Store   |  2   |   18%    |
|     转移      |  4   |   12%    |
| Cache缺失访问 |  8   |   10%    |

方法一：利用CPI

CPU时间 = 2 × 10^5^ × CPI / f

​				= （2 × 10^5^ × 2.24 / 10^9^） = 4.48 × 10^-4^(秒)

ps:主频f和周期T互为倒数

方法二：利用MIPS

CPU时间 = 指令数量/MIPS × 10^6^ = 2 × 10^5^  / (10^3^ / 2.24) × 10 ^-4^ = 4.48 ×10^-4^ (秒)



#### **计算机性能指标是确定的吗？**

![image-20220815205947449](https://eimago.oss-cn-beijing.aliyuncs.com/typora-img/image-20220815205947449.png)



## **计算机性能测试**

### **CPU测试工具**

- CPUmark：综合CPU测试，包括系统存储，浮点运算和逻辑运算；
- SysID：测试CPU电压，运行频率，L1、L2 Cache以及各项技术资料；
- Hot CPU Tester：可测试机器稳定性，尤其是超频后的稳定性，找出CPU的最高超频点或缺陷，还可检测CPU的详细性能指标并给出量化的分数值。包括「复杂矩阵」「排序算法」「快速傅立叶变换」 「CPU 缓存」「内存」「硬盘」 及指令集等。另外其CPU/Mem Burn-in )还可以作为新购机时的烤机软件来使用。



### **显卡测试工具**

- 3DMark：除衡量显卡性能外，已渐渐转变成一款衡量整机性能的软件，已发行3Dmark99、3Dmark 1 1和The new 3DMark等近10个版本；
- N-Bench2：重点测试CPU以及系统图形性能；
- FurMark：通过皮毛渲染算法来衡量显卡的性能及其稳定性, 提供了全屏/窗口、预定分辨率、基于时间或帧的测试、多种多重采样反锯齿、竞赛等多种模式。



### **硬盘测试工具**

- Hard Disk Speed：硬盘测速软件；
- Disk Benchmark：通过对不同大小的数据块对磁盘读/写速度的影响检测硬盘、U盘、 存储卡及其它可移动磁盘的读/写入速率；
- iometer：可被配置为基准测试程序的磁盘和网络I/O的负载,可测试磁盘和网络控制器的性能、总线带宽和时延等参数；
- HDD Temperature Pro:：盘温度探测软件。



### **内存测试工具**

- CTSPD：选择主板厂商及型号后可详细测试内存的信息，包括：CASlatency (列地址选通时延)、RAS to CAS delay(RAS到CAS的相对延迟时间)、RAS precharge Trp (RAS预充电时间)、 DIMM内存生产厂商和DIMM编号等信息。
- Memory Speed：通过读写不同大小的块状数据来测试内存的性能；
- Memory Transfer Timing Utility：通过对源文件和目标文件进行校正和非校正复制,测试内存的读、写速率；

